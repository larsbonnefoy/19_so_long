/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   parsing.c                                          :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: lbonnefo <lbonnefo@student.s19.be>         +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2022/11/14 08:39:03 by lbonnefo          #+#    #+#             */
/*   Updated: 2022/11/15 13:16:15 by lbonnefo         ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "so_long.h"

size_t get_line(t_map *map, int pos);
size_t get_col(t_map *map, int pos);
void check_map(t_map *map);

void get_map(char *map_file, t_map *map)
{
	char *new_line;
	int fd;

	fd = open(map_file, O_RDONLY);	
	if (fd == -1)//erreur d'open
		return ;
	while (1)
	{
		new_line = ft_strtrimf(get_next_line(fd), "\n"); //free dans strtrim
		if (!new_line)
			return ;
		if (map->y == 0)//on est a la premiere ligne
		{	
			map->x = ft_strlen(new_line);
			map->y += 1;
			map->bitmap = ft_strdup(new_line); //creer une copie?
		}
		else
		{	
			if (ft_strlen(new_line) != map->x) //lq premiere ligne est quand meme stored => en cas d'erreur ici tout free;
				return ;
			map->bitmap = ft_strjoinf(map->bitmap, new_line); 
			map->y += 1;
		}
		free(new_line);
	}
}

void check_map(t_map *map)
{
	size_t pos;
	int coll_cnt;
	int player_cnt;
	int exit_cnt;
	
	pos = 0;
	coll_cnt = 0;
	player_cnt = 0;
	exit_cnt = 0;
	while(pos < (map->x*map->y) - 1)
	{
		while (get_line(map, pos) == 0 || get_line(map, pos) == map->y - 1)
		{
			if(map->bitmap[pos] == '1')
				pos++;
			else
			{
				printf("la map elle est pas bonne eft");
				return ;
			}		
		}
		if(map->bitmap[pos] == 'P')
			player_cnt++;
		if(map->bitmap[pos] == 'C')
			coll_cnt++;	
		if(map->bitmap[pos] == 'E')
			exit_cnt++;
		pos++;	
	}
}

size_t get_line(t_map *map, int pos)
{
	size_t line;

	line = pos/map->x;
	printf("2.pos = %d : value = [%c]\n", pos, map->bitmap[pos]);
	return(line);
}

size_t get_col(t_map *map, int pos)
{
	size_t col;

	col = pos%map->x;
	return(col);
}
